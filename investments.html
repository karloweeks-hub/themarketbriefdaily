<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Investments | The Market Brief Daily</title>
  <meta name="description" content="Model portfolio tracker with allocations, pricing, shares, and P&L." />
  <meta name="theme-color" content="#ffffff" />
  <link rel="stylesheet" href="/assets/style.css" />
  <style>
    /* Page-only polish (keeps it professional without breaking global styles) */
    .inv-shell{display:grid;grid-template-columns:360px 1fr;gap:18px;align-items:start}
    @media (max-width: 980px){.inv-shell{grid-template-columns:1fr}}
    .card{background:#fff;border:1px solid rgba(15,23,42,.10);border-radius:16px;box-shadow:0 1px 1px rgba(0,0,0,.03)}
    .card-pad{padding:18px}
    .muted{color:rgba(15,23,42,.65)}
    .tiny{font-size:12px}
    .btnrow{display:flex;gap:10px;flex-wrap:wrap}
    .btnx{appearance:none;border:1px solid rgba(15,23,42,.14);background:#fff;border-radius:999px;padding:10px 12px;font-weight:600;cursor:pointer}
    .btnx:hover{background:rgba(15,23,42,.03)}
    .kpis{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
    @media (max-width: 980px){.kpis{grid-template-columns:repeat(2,1fr)}}
    .kpi{padding:14px;border:1px solid rgba(15,23,42,.10);border-radius:14px}
    .kpi .label{font-size:11px;letter-spacing:.12em;text-transform:uppercase;color:rgba(15,23,42,.55)}
    .kpi .value{font-size:20px;font-weight:800;margin-top:6px}
    .kpi .sub{font-size:12px;color:rgba(15,23,42,.60);margin-top:4px}
    .grid2{display:grid;grid-template-columns:1.1fr .9fr;gap:18px}
    @media (max-width: 980px){.grid2{grid-template-columns:1fr}}
    .pie-wrap{display:flex;gap:14px;align-items:center;justify-content:center;padding:10px 10px 16px}
    .legend{display:grid;gap:8px;align-content:start}
    .lg{display:flex;gap:8px;align-items:center;font-size:13px;color:rgba(15,23,42,.78)}
    .sw{width:10px;height:10px;border-radius:3px;display:inline-block}
    .table-wrap{overflow:auto;border-top:1px solid rgba(15,23,42,.08)}
    table{width:100%;border-collapse:collapse;min-width:980px}
    th,td{padding:12px 14px;border-bottom:1px solid rgba(15,23,42,.08);vertical-align:top}
    th{font-size:11px;letter-spacing:.12em;text-transform:uppercase;color:rgba(15,23,42,.55);background:rgba(15,23,42,.02);position:sticky;top:0;z-index:1}
    td b{font-weight:800}
    .pill{display:inline-flex;align-items:center;border:1px solid rgba(15,23,42,.14);padding:4px 10px;border-radius:999px;font-size:12px;font-weight:700}
    .pill.low{background:rgba(16,185,129,.08);border-color:rgba(16,185,129,.22)}
    .pill.med{background:rgba(245,158,11,.10);border-color:rgba(245,158,11,.25)}
    .pill.high{background:rgba(239,68,68,.10);border-color:rgba(239,68,68,.25)}
    .pos{color:#0a7a3d;font-weight:800}
    .neg{color:#b42318;font-weight:800}
    .row-actions{display:flex;gap:10px;align-items:center;justify-content:flex-end}
    .linkbtn{font-weight:700;text-decoration:none}
    .details{display:none;padding:14px 14px 16px;background:rgba(15,23,42,.02)}
    .details.open{display:block}
    .details .h{display:flex;justify-content:space-between;gap:10px;align-items:flex-start}
    .details h3{margin:0;font-size:16px}
    .details p{margin:8px 0;color:rgba(15,23,42,.78);line-height:1.5}
    .tv{border-radius:14px;overflow:hidden;border:1px solid rgba(15,23,42,.10)}
    .tv iframe{display:block;width:100%;height:420px;border:0}
    .section-gap{height:14px}
  </style>
</head>

<body>
  <a class="skip-link" href="#content">Skip to content</a>

  <header class="site-header">
    <div class="container header-inner">
      <a class="brand" href="/" aria-label="Home">
        <img class="brand-logo" src="/assets/images/logo.png" alt="The Market Brief Daily logo" />
        <span class="brand-stack">
          <span class="brand-title">The Market Brief Daily</span>
          <span class="brand-sub">Market structure • Physical supply • Macro transmission</span>
        </span>
      </a>

      <nav class="nav" aria-label="Primary">
        <a href="/">Home</a>
        <a href="/posts.html">Posts</a>
        <a class="is-active" href="/investments.html">Investments</a>
        <a href="/about.html">About</a>
        <a href="/contact.html">Contact</a>
      </nav>
    </div>
  </header>

  <main id="content" class="page">
    <div class="container">
      <header class="page-header">
        <div class="page-kicker">Investments</div>
        <h1 class="page-title">Model portfolio</h1>
        <p class="page-lead">
          Informational only — not investment advice. See <a href="/disclaimer.html">disclaimer</a>.
        </p>
      </header>

      <div class="inv-shell">
        <!-- LEFT: controls + KPIs -->
        <section class="card" aria-label="Portfolio controls">
          <div class="card-pad">
            <div class="tiny muted" style="letter-spacing:.12em;text-transform:uppercase;">Model portfolio</div>
            <div style="display:flex;justify-content:space-between;gap:12px;align-items:flex-end;margin-top:6px;">
              <div>
                <div style="font-weight:900;font-size:18px;">Portfolio capital: <span id="capLabel">US$100,000</span></div>
                <div class="tiny muted" style="margin-top:6px;">
                  Entry date: <b>2026-02-12</b> (entry fixed). Current prices refresh from <code>/data/prices.json</code> (hourly).
                </div>
                <div class="tiny muted" style="margin-top:4px;">Price feed as-of: <span id="asOf">—</span></div>
              </div>
            </div>

            <div class="section-gap"></div>

            <div class="btnrow">
              <button class="btnx" id="btnRefresh">Refresh prices</button>
              <button class="btnx" id="btnReset">Reset portfolio</button>
            </div>

            <div class="section-gap"></div>

            <div class="kpis">
              <div class="kpi">
                <div class="label">Net liquidation</div>
                <div class="value" id="kNet">—</div>
                <div class="sub">Cash + holdings value</div>
              </div>
              <div class="kpi">
                <div class="label">Total P&L</div>
                <div class="value" id="kPnL">—</div>
                <div class="sub">Since entry open</div>
              </div>
              <div class="kpi">
                <div class="label">Cash</div>
                <div class="value" id="kCash">—</div>
                <div class="sub">Unallocated cash</div>
              </div>
              <div class="kpi">
                <div class="label">Exposure</div>
                <div class="value" id="kExp">—</div>
                <div class="sub">Market value invested</div>
              </div>
            </div>

            <div class="section-gap"></div>

            <div class="card" style="border-radius:14px;">
              <div class="card-pad tiny muted" style="line-height:1.55;">
                <b>Constraint:</b> each holding is capped at <b>5%</b> of total capital. The remainder stays as cash by design.<br/>
                <b>Mechanics:</b> shares = allocation ÷ entry. P&L updates automatically as current prices update.
              </div>
            </div>
          </div>
        </section>

        <!-- RIGHT: pie -->
        <section class="card" aria-label="Allocation pie">
          <div class="card-pad">
            <div class="tiny muted" style="letter-spacing:.12em;text-transform:uppercase;">Allocation pie</div>
            <h2 style="margin:6px 0 0 0;font-size:22px;">Portfolio allocations</h2>
            <div class="muted" style="margin-top:6px;">Includes cash. Holdings are capped at 5% each.</div>

            <div class="pie-wrap">
              <canvas id="pie" width="320" height="320" aria-label="Allocation pie chart"></canvas>
              <div class="legend" id="legend"></div>
            </div>

            <div class="tiny muted" style="text-align:center;padding-bottom:6px;">
              Tip: to add more stocks later, edit the <code>DEFAULT_PORTFOLIO.holdings</code> block in this file.
            </div>
          </div>
        </section>
      </div>

      <div class="section-gap"></div>

      <!-- Holdings table -->
      <section class="card" aria-label="Holdings table">
        <div class="card-pad">
          <div class="tiny muted" style="letter-spacing:.12em;text-transform:uppercase;">Holdings</div>
          <h2 style="margin:6px 0 0 0;font-size:22px;">Portfolio holdings</h2>
          <div class="muted" style="margin-top:6px;">
            Entry is fixed (market open on 2026-02-12). Current prices update hourly when <code>/data/prices.json</code> updates.
          </div>
        </div>

        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th style="min-width:240px;">Stock</th>
                <th>Risk</th>
                <th>Allocation</th>
                <th>Entry (Open 2026-02-12)</th>
                <th>Current</th>
                <th>Shares</th>
                <th>Market value</th>
                <th>P&L</th>
                <th>P&L %</th>
                <th style="min-width:160px;"></th>
              </tr>
            </thead>
            <tbody id="rows"></tbody>
          </table>
        </div>
      </section>

      <div class="section-gap"></div>

      <!-- Detail drawer -->
      <section class="card" aria-label="Thesis and chart">
        <div class="card-pad">
          <div style="display:flex;justify-content:space-between;gap:12px;align-items:flex-start;flex-wrap:wrap;">
            <div>
              <div class="tiny muted" style="letter-spacing:.12em;text-transform:uppercase;">Thesis</div>
              <h2 style="margin:6px 0 0 0;font-size:22px;">Click a holding to view rationale</h2>
              <div class="muted" style="margin-top:6px;">
                Each holding includes thesis + primary risks and links to the selection post (update links as you publish those).
              </div>
            </div>
            <a class="btnx linkbtn" href="/posts.html">Open newsroom</a>
          </div>

          <div class="section-gap"></div>

          <div id="detailBox" class="details open" style="border-radius:14px;">
            <div class="h">
              <div>
                <h3 id="dTitle">Select a holding</h3>
                <div class="tiny muted" id="dMeta">—</div>
              </div>
              <div class="row-actions">
                <a id="dPost" class="linkbtn" href="/posts.html">View selection post →</a>
              </div>
            </div>

            <p><b>Why it’s on the list:</b> <span id="dWhy">—</span></p>
            <p><b>Primary risks:</b> <span id="dRisks">—</span></p>

            <div class="section-gap"></div>

            <div class="tv">
              <!-- TradingView advanced chart (works for these US tickers) -->
              <iframe id="tvFrame"
                title="Chart"
                loading="lazy"
                src="https://s.tradingview.com/widgetembed/?frameElementId=tradingview&symbol=NYSE%3AAGI&interval=D&hidesidetoolbar=1&symboledit=1&saveimage=0&toolbarbg=ffffff&studies=%5B%5D&hideideas=1&theme=light&style=1&timezone=Etc%2FUTC&withdateranges=1&hidevolume=0&allow_symbol_change=1">
              </iframe>
            </div>
          </div>
        </div>
      </section>

      <div class="section-gap"></div>

      <div class="note">
        <b>Important:</b> GitHub Pages can’t reliably fetch live market data directly from the browser (CORS/API keys).
        The professional approach is exactly this: a GitHub Action updates <code>/data/prices.json</code> hourly, and the site reads it.
      </div>

    </div>
  </main>

  <footer class="site-footer">
    <div class="container footer-inner">
      <div>
        <div class="footer-brand">The Market Brief Daily</div>
        <div class="footer-sub">Market structure & physical supply analysis.</div>
      </div>
      <div class="footer-links">
        <a href="/posts.html">Posts</a>
        <a href="/about.html">About</a>
        <a href="/disclaimer.html">Disclaimer</a>
      </div>
    </div>
  </footer>

  <script>
    /**
     * Fixed entry prices = market open on 2026-02-12.
     * Source (captured at time of build):
     *  AGI open 45.67  
     *  FSM open 11.32  
     *  GAU open 3.12   
     *  NFGC open 2.95  
     *  VGZ open 2.98   
     *  NEWP open 3.90  
     *
     * Current prices are read from /data/prices.json and will update hourly via GitHub Actions.
     */

    const STORAGE_KEY = "mbd_portfolio_v2";

    const DEFAULT_PORTFOLIO = {
      baseCurrency: "USD",
      capital: 100000,
      entryDate: "2026-02-12",
      holdings: [
        {
          name: "Alamos Gold",
          ticker: "AGI",
          tvSymbol: "NYSE:AGI",
          risk: "Lower",
          allocation: 5000, // 5% cap
          entry: 45.67,
          why: "Established producer profile with clearer cost / FCF dynamics versus pre-revenue developers; potential production growth optionality.",
          risks: "Execution risk on guidance, cost inflation, and commodity beta.",
          selectionPost: "/posts.html"
        },
        {
          name: "Fortuna Mining",
          ticker: "FSM",
          tvSymbol: "NYSE:FSM",
          risk: "Lower",
          allocation: 5000,
          entry: 11.32,
          why: "Diversified operating footprint and liquid listing; a practical gold/silver hybrid to express metals exposure without single-asset dependence.",
          risks: "Jurisdiction and operational risk across regions; cost control; metals-price volatility.",
          selectionPost: "/posts.html"
        },
        {
          name: "Galiano Gold",
          ticker: "GAU",
          tvSymbol: "NYSEAMERICAN:GAU",
          risk: "Medium",
          allocation: 5000,
          entry: 3.12,
          why: "Asymmetric turnaround characteristics; exploration/updated resources can move small caps disproportionately.",
          risks: "Single-asset concentration, operational disruption risk, and higher volatility typical of small caps.",
          selectionPost: "/posts.html"
        },
        {
          name: "Newfound Gold",
          ticker: "NFGC",
          tvSymbol: "NYSEAMERICAN:NFGC",
          risk: "Higher",
          allocation: 5000,
          entry: 2.95,
          why: "High-grade Canadian discovery optionality; catalysts are exploration results and development milestones.",
          risks: "Pre-revenue development (financing/dilution), timeline slippage, permitting, and gap between discovery excitement and economic development.",
          selectionPost: "/posts.html"
        },
        {
          name: "Vista Gold",
          ticker: "VGZ",
          tvSymbol: "NYSEAMERICAN:VGZ",
          risk: "Higher",
          allocation: 5000,
          entry: 2.98,
          why: "Single-asset development exposure can behave like ‘pure leverage’ to gold price under the right conditions.",
          risks: "No operating revenue, long timelines (late-decade execution), financing requirements, and commodity-price leverage cuts both ways.",
          selectionPost: "/posts.html"
        },
        {
          name: "New Pacific Metals",
          ticker: "NEWP",
          tvSymbol: "NYSEAMERICAN:NEWP",
          risk: "Higher",
          allocation: 5000,
          entry: 3.90,
          why: "Large undeveloped silver projects; upside if silver is bullish and the project de-risks over time.",
          risks: "Country/geopolitical risk (including nationalization history), community relations, and silver’s higher volatility vs gold.",
          selectionPost: "/posts.html"
        }
      ]
    };

    const COLORS = {
      AGI: "#2563eb",
      FSM: "#ec4899",
      GAU: "#f59e0b",
      NFGC: "#ef4444",
      VGZ: "#10b981",
      NEWP: "#8b5cf6",
      CASH: "#94a3b8"
    };

    function money(n, digits=2){
      if (n === null || n === undefined || Number.isNaN(n)) return "—";
      return n.toLocaleString(undefined,{style:"currency",currency:"USD",maximumFractionDigits:digits,minimumFractionDigits:digits});
    }
    function pct(n){
      if (n === null || n === undefined || Number.isNaN(n)) return "—";
      return (n*100).toFixed(2) + "%";
    }

    function clone(x){ return JSON.parse(JSON.stringify(x)); }

    function loadPortfolio(){
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return clone(DEFAULT_PORTFOLIO);
      try { return JSON.parse(raw); }
      catch { return clone(DEFAULT_PORTFOLIO); }
    }
    function savePortfolio(p){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(p));
    }

    async function fetchPrices(){
      // Cache-bust to avoid GH Pages aggressive caching
      const url = "/data/prices.json?cb=" + Date.now();
      const res = await fetch(url, {cache:"no-store"});
      if (!res.ok) throw new Error("Failed to load /data/prices.json");
      return await res.json();
    }

    function calc(p, prices){
      const cap = p.capital;
      const investedCost = p.holdings.reduce((s,h)=>s+h.allocation,0);
      const cash = Math.max(0, cap - investedCost);

      const rows = p.holdings.map(h => {
        const entry = Number(h.entry);
        const current = prices?.quotes?.[h.ticker]?.price ?? null;

        const shares = (entry && entry > 0) ? (h.allocation / entry) : null;
        const mkt = (shares !== null && current !== null) ? (shares * current) : null;
        const mktOrCost = (mkt === null) ? h.allocation : mkt;

        const pnl = (mkt === null) ? 0 : (mkt - h.allocation);
        const pnlPct = (mkt === null) ? 0 : (pnl / h.allocation);

        return { h, entry, current, shares, mkt: mktOrCost, pnl, pnlPct };
      });

      const exposure = rows.reduce((s,r)=>s + r.mkt, 0);
      const totalPnL = rows.reduce((s,r)=>s + r.pnl, 0);
      const net = cash + exposure;

      return { cap, cash, exposure, totalPnL, net, rows };
    }

    function riskPill(risk){
      if (risk === "Lower") return '<span class="pill low">Lower risk</span>';
      if (risk === "Medium") return '<span class="pill med">Medium risk</span>';
      return '<span class="pill high">Higher risk</span>';
    }

    function renderTable(model){
      const tbody = document.getElementById("rows");
      tbody.innerHTML = "";

      model.rows.forEach((r, idx) => {
        const tr = document.createElement("tr");
        const pnlClass = r.pnl >= 0 ? "pos" : "neg";

        tr.innerHTML = `
          <td>
            <div><b>${r.h.name}</b> <span class="muted">(${r.h.ticker})</span></div>
            <div class="tiny muted">Entry date: ${DEFAULT_PORTFOLIO.entryDate}</div>
          </td>
          <td>${riskPill(r.h.risk)}</td>
          <td>${money(r.h.allocation, 0)}</td>
          <td>${money(r.entry, 2)}</td>
          <td>${r.current === null ? "—" : money(r.current, 3)}</td>
          <td>${r.shares === null ? "—" : r.shares.toFixed(4)}</td>
          <td>${money(r.mkt, 2)}</td>
          <td class="${pnlClass}">${money(r.pnl, 2)}</td>
          <td class="${pnlClass}">${pct(r.pnlPct)}</td>
          <td>
            <div class="row-actions">
              <button class="btnx" data-idx="${idx}" data-action="details">View thesis</button>
            </div>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    function drawPie(model){
      const canvas = document.getElementById("pie");
      const ctx = canvas.getContext("2d");
      const legend = document.getElementById("legend");
      legend.innerHTML = "";

      const data = [];
      model.rows.forEach(r => data.push({label:r.h.ticker, value:r.h.allocation, color:COLORS[r.h.ticker]}));
      data.push({label:"CASH", value:model.cash, color:COLORS.CASH});

      const total = data.reduce((s,d)=>s+d.value,0);
      const cx = canvas.width/2, cy = canvas.height/2;
      const R = Math.min(cx, cy) - 10;
      const r0 = R * 0.62;

      ctx.clearRect(0,0,canvas.width,canvas.height);

      // ring background
      ctx.beginPath();
      ctx.arc(cx,cy,R,0,Math.PI*2);
      ctx.closePath();
      ctx.fillStyle = "rgba(15,23,42,.05)";
      ctx.fill();

      let start = -Math.PI/2;
      data.forEach(d => {
        const a = (d.value/total) * Math.PI*2;
        ctx.beginPath();
        ctx.moveTo(cx,cy);
        ctx.arc(cx,cy,R,start,start+a);
        ctx.closePath();
        ctx.fillStyle = d.color;
        ctx.fill();
        start += a;
      });

      // hole
      ctx.beginPath();
      ctx.arc(cx,cy,r0,0,Math.PI*2);
      ctx.closePath();
      ctx.fillStyle = "#fff";
      ctx.fill();

      // center label
      ctx.fillStyle = "rgba(15,23,42,.75)";
      ctx.font = "700 14px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial";
      ctx.textAlign = "center";
      ctx.fillText("Net Liq", cx, cy - 8);
      ctx.fillStyle = "rgba(15,23,42,.95)";
      ctx.font = "800 18px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial";
      ctx.fillText(money(model.net, 2), cx, cy + 18);

      // legend
      data.forEach(d => {
        const pctVal = total > 0 ? (d.value/total) : 0;
        const div = document.createElement("div");
        div.className = "lg";
        div.innerHTML = `<span class="sw" style="background:${d.color}"></span>
          <span><b>${d.label}</b> <span class="muted">${pct(pctVal)}</span></span>`;
        legend.appendChild(div);
      });
    }

    function setKPIs(model){
      document.getElementById("capLabel").textContent = "US$" + model.cap.toLocaleString();
      document.getElementById("kCash").textContent = money(model.cash, 2);
      document.getElementById("kExp").textContent = money(model.exposure, 2);
      document.getElementById("kPnL").textContent = money(model.totalPnL, 2);
      document.getElementById("kNet").textContent = money(model.net, 2);
    }

    function openDetails(h){
      const box = document.getElementById("detailBox");
      box.classList.add("open");

      document.getElementById("dTitle").textContent = `${h.name} (${h.ticker})`;
      document.getElementById("dMeta").textContent = `Allocation: ${money(h.allocation,0)} • Risk: ${h.risk} • Entry open (2026-02-12): ${money(h.entry,2)}`;
      document.getElementById("dWhy").textContent = h.why;
      document.getElementById("dRisks").textContent = h.risks;

      const post = document.getElementById("dPost");
      post.href = h.selectionPost || "/posts.html";

      // update TV symbol
      const sym = encodeURIComponent(h.tvSymbol || ("NYSE:" + h.ticker));
      const src = `https://s.tradingview.com/widgetembed/?frameElementId=tradingview&symbol=${sym}&interval=D&hidesidetoolbar=1&symboledit=1&saveimage=0&toolbarbg=ffffff&studies=%5B%5D&hideideas=1&theme=light&style=1&timezone=Etc%2FUTC&withdateranges=1&hidevolume=0&allow_symbol_change=1`;
      document.getElementById("tvFrame").src = src;
    }

    async function renderAll(){
      const p = loadPortfolio();

      // Try load prices feed; if missing, still render using cost/entry
      let prices = null;
      try {
        prices = await fetchPrices();
        document.getElementById("asOf").textContent = prices.asOf ? prices.asOf : "—";
      } catch {
        document.getElementById("asOf").textContent = "—";
        prices = { quotes: {} };
      }

      const model = calc(p, prices);

      setKPIs(model);
      drawPie(model);
      renderTable(model);

      // Default details to first holding
      openDetails(p.holdings[0]);

      // Save (in case you later tweak holdings)
      savePortfolio(p);
    }

    function wire(){
      document.getElementById("btnReset").addEventListener("click", () => {
        savePortfolio(clone(DEFAULT_PORTFOLIO));
        renderAll();
      });

      document.getElementById("btnRefresh").addEventListener("click", () => {
        renderAll();
      });

      document.addEventListener("click", (e) => {
        const btn = e.target.closest("button[data-action='details']");
        if (!btn) return;
        const idx = parseInt(btn.getAttribute("data-idx"), 10);
        const p = loadPortfolio();
        openDetails(p.holdings[idx]);
      });

      // auto-refresh page view hourly (matches your feed cadence)
      setInterval(renderAll, 60 * 60 * 1000);
    }

    wire();
    renderAll();
  </script>
</body>
</html>
